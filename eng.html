<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±è¯­å¤ä¹ ç¥å™¨ (è‡ªåŠ¨å­˜æ¡£ç‰ˆ)</title>
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --warning: #f1c40f;
            --error: #e74c3c;
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --text: #2c3e50;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            padding-bottom: 120px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 { text-align: center; margin-bottom: 15px; color: #333; font-size: 1.5rem; }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .stat-item span { display: block; font-size: 1.2em; margin-top: 5px; }

        /* Tabs */
        .tabs {
            display: flex;
            background: #e1e4e8;
            padding: 5px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: 0.3s;
        }
        .tab.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Vocab List Style */
        .vocab-item {
            background: var(--card-bg);
            margin-bottom: 12px;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
            border-left: 6px solid #ddd;
        }

        .vocab-item.known { border-left-color: var(--success); background-color: #f6fffa; opacity: 0.7; }
        .vocab-item.unknown { border-left-color: var(--error); background-color: #fff5f5; border-right: 1px solid var(--error); }

        .word-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .english-word {
            font-size: 1.25em;
            font-weight: bold;
            color: #2c3e50;
        }

        .meaning-box {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #eee;
            display: none;
            animation: slideDown 0.2s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        button {
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            font-size: 14px;
        }
        
        .btn-show { background: #e3f2fd; color: var(--primary); width: 100%; padding: 12px; }
        .btn-right { background: var(--success); color: white; flex: 1; margin-left: 5px;}
        .btn-wrong { background: var(--error); color: white; flex: 1; margin-right: 5px;}

        /* Exercise Styles */
        .exercise-group h3 {
            margin-top: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }
        .exercise-item { 
            background: white; 
            padding: 18px; 
            margin-bottom: 12px; 
            border-radius: 12px; 
            line-height: 2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: 0.3s;
        }
        .exercise-item.wrong-state {
            border: 2px solid var(--error);
            background: #fff5f5;
        }
        .exercise-item.correct-state {
            border: 2px solid var(--success);
            background: #f0fff4;
        }

        .blank-input { 
            border: none; 
            border-bottom: 2px solid #bbb; 
            width: 140px; 
            text-align: center; 
            font-weight: bold; 
            color: var(--primary); 
            font-size: 18px;
            background: transparent;
            margin: 0 5px;
            padding: 2px 0;
            transition: 0.3s;
        }
        .blank-input:focus { outline: none; border-bottom-color: var(--primary); background: rgba(74, 144, 226, 0.1); border-radius: 4px;}
        .blank-input.correct { border-bottom-color: var(--success); color: var(--success); }
        .blank-input.wrong { border-bottom-color: var(--error); color: var(--error); }
        
        .ans-tag { display: none; color: var(--success); font-weight: bold; font-size: 0.9em; margin-top: 8px; background: #e8f8f5; padding: 5px 10px; border-radius: 4px; display: inline-block;}

        /* Floating Review Button */
        .review-fab {
            position: fixed;
            bottom: 30px;
            right: 20px;
            background: var(--error);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            font-weight: bold;
            cursor: pointer;
            display: none;
            z-index: 100;
            animation: bounce 2s infinite;
            font-size: 16px;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
            backdrop-filter: blur(5px);
        }
        
        .flashcard {
            background: white;
            width: 90%;
            max-width: 450px;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .tag-type {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #ccc; }

        /* Exercise Review Specifics */
        .ex-review-container {
            text-align: left;
            margin: 20px 0;
            font-size: 1.1em;
            line-height: 1.8;
        }
        .ex-review-input {
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .feedback-msg {
            min-height: 24px;
            margin-top: 10px;
            font-weight: bold;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“š è‹±è¯­å¤ä¹ ç¥å™¨ <span style="font-size:0.6em; color:#888; font-weight:normal;">(è‡ªåŠ¨å­˜æ¡£)</span></h1>
    
    <div class="stats-bar">
        <div class="stat-item" style="color:var(--success)">
            å·²æŒæ¡<br><span id="count-known">0</span>
        </div>
        <div class="stat-item" style="color:var(--error)">
            å¾…å¤ä¹ <br><span id="count-review">0</span>
        </div>
        <div class="stat-item" style="color:#666">
            æ€»è¿›åº¦<br><span id="progress-percent">0%</span>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('vocab')">ğŸ“ å•è¯ (147è¯)</div>
        <div class="tab" onclick="switchTab('exercise')">âœï¸ å¡«ç©º (57é¢˜)</div>
    </div>

    <div id="vocab-section">
        <input type="text" id="search" placeholder="ğŸ” æœç´¢å•è¯..." style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; font-size: 16px;" onkeyup="renderVocabList()">
        <div id="vocab-list"></div>
    </div>

    <div id="exercise-section" style="display: none;">
        <div style="background: #e3f2fd; padding: 15px; margin-bottom: 20px; border-radius: 8px; color: #0d47a1; border: 1px solid #bbdefb; font-size: 0.95em;">
            âš¡ <b>åŠŸèƒ½æ›´æ–°</b>ï¼šå¡«å®Œä¸€ä¸ªç©ºï¼ŒæŒ‰å›è½¦æˆ–ç‚¹æ—è¾¹ï¼Œç³»ç»Ÿä¼š<b>ç«‹å³åˆ¤æ–­</b>ã€‚é”™äº†ä¼šè‡ªåŠ¨åŠ å…¥å¤ä¹ é˜Ÿåˆ—ï¼
        </div>
        <div id="exercise-list"></div>
        
        <div style="margin-top:30px; text-align:center;">
             <button onclick="clearAllProgress()" style="background:#b0bec5; color:white; font-size:0.8em; padding:8px 15px;">âš ï¸ æ¸…é™¤æ‰€æœ‰è¿›åº¦ (é‡ç½®)</button>
        </div>
    </div>
</div>

<div id="review-btn" class="review-fab" onclick="startReviewMode()">
    ğŸ”¥ å¤ä¹ é”™é¢˜ (<span id="review-count-badge">0</span>)
</div>

<div id="review-modal" class="modal-overlay">
    <div class="flashcard">
        <div class="close-modal" onclick="closeReview()">Ã—</div>
        <div id="card-tag" class="tag-type">VOCAB</div>
        
        <div id="vocab-review-ui" style="display:none;">
            <h2 id="card-word" style="margin-top:20px;">Loading...</h2>
            
            <div id="card-mask" onclick="revealCard()" style="cursor: pointer; background: #f8f9fa; padding: 30px; border-radius: 10px; margin: 20px 0; border: 2px dashed #ddd;">
                ğŸ‘† ç‚¹å‡»æŸ¥çœ‹é‡Šä¹‰
            </div>

            <div id="card-answer" style="display: none;">
                <div class="meaning" id="card-meaning" style="font-size: 1.3em; margin: 20px 0; color: #555;">...</div>
                <div class="action-buttons" style="display:flex; gap:10px;">
                    <button class="btn-wrong" onclick="processVocabReview(false)">ğŸ˜° æ²¡è®°ä½</button>
                    <button class="btn-right" onclick="processVocabReview(true)">ğŸ˜ è®°ä½äº†</button>
                </div>
            </div>
        </div>

        <div id="exercise-review-ui" style="display:none;">
            <div id="ex-review-content" class="ex-review-container"></div>
            <input type="text" id="ex-review-input" class="ex-review-input" placeholder="åœ¨æ­¤è¾“å…¥ç­”æ¡ˆ..." autocomplete="off">
            <div id="ex-feedback" class="feedback-msg"></div>
            <button onclick="checkReviewExercise()" style="width:100%; background:var(--primary); color:white; margin-top:10px; padding:12px;">æäº¤</button>
        </div>

    </div>
</div>

<script>
    // === 1. æ•°æ®æº ===
    const vocabData = [
        {en: "fellowman", cn: "åŒèƒ"}, {en: "insight", cn: "æ´å¯ŸåŠ›; é¡¿æ‚Ÿ"}, {en: "vanity", cn: "è™šè£; è‡ªè´Ÿ"},
        {en: "for sb.'s (own) part", cn: "å°±...è€Œè¨€"}, {en: "reflection", cn: "æƒ³æ³•; æ·±æ€; å€’å½±"}, {en: "occur to (sb.)", cn: "(ä¸»æ„)çªç„¶æµ®ç°"},
        {en: "be (all) of a piece (with sth.)", cn: "ä¸...æµ‘ç„¶ä¸€ä½“; ä¸€è‡´"}, {en: "slender", cn: "çº¤ç»†çš„; ä¿®é•¿çš„"}, {en: "wrinkle", cn: "çš±çº¹; ä½¿èµ·çš±çº¹"},
        {en: "in accordance with", cn: "ä¸...ä¸€è‡´; æŒ‰ç…§"}, {en: "station", cn: "ç¤¾ä¼šåœ°ä½"}, {en: "dine", cn: "è¿›é¤"},
        {en: "elderly", cn: "å¹´é•¿çš„"}, {en: "affectionate", cn: "å……æ»¡çˆ±çš„; æ·±æƒ…çš„"}, {en: "kindliness", cn: "ä½“è´´; å’Œå–„"},
        {en: "mild", cn: "æ¸©å’Œçš„"}, {en: "benign", cn: "å’Œè”¼çš„; (åŒ»)è‰¯æ€§çš„"}, {en: "cocktail", cn: "é¸¡å°¾é…’"},
        {en: "spicy", cn: "è¾›è¾£çš„; åˆºæ¿€çš„"}, {en: "something of a(n)", cn: "å¯ä»¥è¯´æ˜¯ä¸€ä¸ª...; ç›¸å½“çªå‡ºçš„"}, {en: "athlete", cn: "è¿åŠ¨å‘˜"},
        {en: "instinct", cn: "æœ¬èƒ½; ç›´è§‰"}, {en: "lounge", cn: "ä¼‘æ¯å®¤; æ—…é¦†å¤§å…"}, {en: "fizz", cn: "èµ·æ³¡é¥®æ–™"},
        {en: "remittance", cn: "æ±‡æ¬¾"}, {en: "namesake", cn: "åŒåè€…"}, {en: "uncanny", cn: "ä¸å¯æ€è®®çš„; è¶…å¸¸çš„"},
        {en: "sip", cn: "å°å£å–"}, {en: "chap", cn: "å®¶ä¼™; å°ä¼™å­"}, {en: "curly", cn: "å·æ›²çš„"}, {en: "chuckle", cn: "è½»ç¬‘"},
        {en: "with (a) good grace", cn: "ç¤¼è²Œåœ°; ä¸å¤±ä¼˜é›…åœ°"}, {en: "stroke", cn: "è½»æŠš; æŠšæ‘©"}, {en: "vein", cn: "é™è„‰; è¡€ç®¡"},
        {en: "transparent", cn: "é€æ˜çš„"}, {en: "go broke", cn: "ç ´äº§; ä¸€æ–‡ä¸å"}, {en: "hitherto", cn: "è¿„ä»Š; ç›´åˆ°æ­¤æ—¶"},
        {en: "cannot help doing sth.", cn: "å¿ä¸ä½åšæŸäº‹"}, {en: "not just yet", cn: "æš‚æ—¶å°šæœª"}, {en: "poker", cn: "æ‰‘å…‹ç‰Œæ¸¸æˆ"},
        {en: "trim", cn: "å‡»è´¥; ä¿®å‰ª"}, {en: "pawn", cn: "å…¸å½“; æŠµæŠ¼"}, {en: "down and out", cn: "ç©·å›°æ½¦å€’"},
        {en: "commit", cn: "åš(åäº‹); çŠ¯ç½ª"}, {en: "suicide", cn: "è‡ªæ€"}, {en: "be/go/fall (all) to pieces", cn: "å´©æºƒ; å®æ‰"},
        {en: "insane", cn: "ç–¯ç™«çš„; è’å”çš„"}, {en: "glimmering", cn: "æ¨¡ç³Šçš„æ„Ÿè§‰/è®¤è¯†"}, {en: "drive at", cn: "æ„æŒ‡; è¦è¯´"},
        {en: "beacon", cn: "ç¯å¡”; ä¿¡å·ç¯"}, {en: "creek", cn: "å°æ¹¾; å°æºª"}, {en: "on account of", cn: "ç”±äº; å› ä¸º"},
        {en: "be taken aback", cn: "åƒæƒŠ; å“ä¸€è·³"}, {en: "in (good/poor) condition", cn: "èº«ä½“çŠ¶å†µå¥½/ä¸å¥½"}, {en: "turn up", cn: "æ¥åˆ°; å‡ºç°"},
        {en: "funk", cn: "å› ææƒ§é¿å¼€"}, {en: "constitution", cn: "ä½“æ ¼; ä½“è´¨"}, {en: "dissipation", cn: "æ”¾è¡; çºµä¹"},
        {en: "a trifle", cn: "ç¨å¾®; æœ‰ç‚¹å„¿"}, {en: "candid", cn: "çœŸè¯šå¦ç‡çš„"}, {en: "rub", cn: "æ‘©æ“¦; æ“"}, {en: "vacancy", cn: "ç©ºç¼º; ç©ºèŒ"},
        {en: "overstate", cn: "å¤¸å¤§; è¨€è¿‡å…¶å®"}, {en: "technological", cn: "æŠ€æœ¯çš„"}, {en: "innovation", cn: "åˆ›æ–°; é©æ–°"},
        {en: "exaggerate", cn: "å¤¸å¤§; å¤¸å¼ "}, {en: "breakthrough", cn: "çªç ´"}, {en: "reliance", cn: "ä¾èµ–; ä¾é "},
        {en: "all too", cn: "å®åœ¨å¤ª..."}, {en: "regrettably", cn: "é—æ†¾åœ°"}, {en: "giant", cn: "å·¨äºº; å·¨å¤´"}, {en: "valid", cn: "æœ‰æ•ˆçš„; æœ‰æ ¹æ®çš„"},
        {en: "foster", cn: "åŸ¹å…»; ä¿ƒè¿›"}, {en: "extreme", cn: "æç«¯çš„"}, {en: "superior", cn: "ä¼˜è‰¯çš„; è¾ƒå¥½çš„"}, {en: "strike a balance", cn: "å¹³è¡¡; æŠ˜ä¸­"},
        {en: "continual", cn: "ä¸æ–­çš„; å†ä¸‰é‡å¤çš„"}, {en: "confidence", cn: "ä¿¡å¿ƒ"}, {en: "calligrapher", cn: "ä¹¦æ³•å®¶"},
        {en: "perfect", cn: "ä½¿å®Œç¾"}, {en: "in terms of", cn: "å°±...è€Œè¨€; åœ¨...æ–¹é¢"}, {en: "reversal", cn: "é¢ å€’; é€†è½¬"},
        {en: "inseparable", cn: "ä¸å¯åˆ†ç¦»çš„"}, {en: "over time", cn: "éšç€æ—¶é—´çš„æ¨ç§»"}, {en: "summarize", cn: "æ€»ç»“; æ¦‚è¿°"},
        {en: "originality", cn: "æ–°é¢–; ç‹¬åˆ›æ€§"}, {en: "harbor", cn: "æ€€æœ‰; æŠ±æœ‰"}, {en: "acquire", cn: "è·å¾—; å…»æˆ"},
        {en: "comparable", cn: "ç±»ä¼¼çš„; å¯æ¯”çš„"}, {en: "promote", cn: "ä¿ƒè¿›; æ¨è¿›"}, {en: "make up for", cn: "è¡¥å¿; å¼¥è¡¥"},
        {en: "misdeed", cn: "ä¸ç«¯è¡Œä¸º"}, {en: "series", cn: "ç³»åˆ—"}, {en: "on one's own", cn: "ç‹¬ç«‹åœ°; ç‹¬è‡ª"},
        {en: "educational", cn: "æ•™è‚²çš„"}, {en: "artistic", cn: "è‰ºæœ¯çš„"}, {en: "well-intentioned", cn: "å¥½æ„çš„"},
        {en: "come to sb.'s rescue", cn: "å¸®æŸäººæ‘†è„±å›°å¢ƒ"}, {en: "facility", cn: "ç†Ÿç»ƒ; è®¾å¤‡"}, {en: "mold", cn: "å¡‘é€ "},
        {en: "performance", cn: "æ‰§è¡Œ; è¡¨ç°; æ¼”å‡º"}, {en: "so much so that", cn: "åˆ°è¿™æ ·ç¨‹åº¦ä»¥è‡³äº"}, {en: "complex", cn: "å¤æ‚çš„"},
        {en: "in due course", cn: "åœ¨é€‚å½“çš„æ—¶å€™"}, {en: "matter", cn: "é‡è¦; è¦ç´§"}, {en: "critical", cn: "è‡³å…³é‡è¦çš„; å±æ€¥çš„"},
        {en: "self-reliance", cn: "è‡ªåŠ›æ›´ç”Ÿ"}, {en: "principal", cn: "ä¸»è¦çš„; é¦–è¦çš„"}, {en: "middle-class", cn: "ä¸­äº§é˜¶çº§çš„"},
        {en: "insert", cn: "æ’å…¥; åµŒå…¥"}, {en: "expectantly", cn: "æœŸå¾…åœ°"}, {en: "expectant", cn: "æœŸå¾…çš„"}, {en: "await", cn: "ç­‰å¾…"},
        {en: "on occasion", cn: "æœ‰æ—¶; é—´æˆ–"}, {en: "frown", cn: "çš±çœ‰"}, {en: "parental", cn: "çˆ¶æ¯çš„"}, {en: "incident", cn: "äº‹ä»¶"},
        {en: "relevant", cn: "æœ‰å…³çš„; åˆ‡é¢˜çš„"}, {en: "assign", cn: "åˆ†æ´¾; æŒ‡æ´¾"}, {en: "investigate", cn: "è°ƒæŸ¥"},
        {en: "cast/shed/throw light on", cn: "ç»™...æä¾›æ–°ä¿¡æ¯"}, {en: "creativity", cn: "åˆ›é€ åŠ›"}, {en: "anecdote", cn: "è¶£é—»; è½¶äº‹"},
        {en: "educator", cn: "æ•™è‚²å·¥ä½œè€…"}, {en: "colleague", cn: "åŒäº‹"}, {en: "desirable", cn: "å€¼å¾—å‘å¾€çš„; ç§°å¿ƒçš„"},
        {en: "outcome", cn: "ç»“æœ; ç»“å±€"}, {en: "proceed", cn: "ç»§ç»­è¿›è¡Œ"}, {en: "lobby", cn: "å¤§å…"}, {en: "turn in", cn: "ä¸Šäº¤"},
        {en: "attendant", cn: "æœåŠ¡å‘˜; ä¾è€…"}, {en: "slot", cn: "ç‹­ç¼; ç‹­æ§½"}, {en: "vigorously", cn: "ç”¨åŠ›åœ°; ç²¾åŠ›å……æ²›åœ°"},
        {en: "vigorous", cn: "å……æ»¡æ´»åŠ›çš„"}, {en: "tender", cn: "å¹´å¹¼çš„"}, {en: "just so", cn: "æ°åˆ°å¥½å¤„åœ°"},
        {en: "not ... in the least", cn: "ä¸€ç‚¹ä¹Ÿä¸"}, {en: "bang", cn: "çŒ›å‡»; çŒ›æ’"}, {en: "exploratory", cn: "æ¢ç´¢çš„"},
        {en: "observe", cn: "è§‚å¯Ÿ; æ³¨æ„åˆ°"}, {en: "phenomenon", cn: "ç°è±¡"}, {en: "staff", cn: "èŒå‘˜"},
        {en: "initial", cn: "å¼€å§‹çš„; æœ€åˆçš„"}, {en: "reposition", cn: "æ”¹å˜...çš„ä½ç½®"}, {en: "alliance", cn: "è”ç›Ÿ"},
        {en: "assemble", cn: "é›†åˆ; ç»„è£…"}, {en: "bleak", cn: "è’å‡‰çš„; æš—æ·¡çš„"}, {en: "campaign", cn: "è¿åŠ¨; æˆ˜å½¹"},
        {en: "decisive", cn: "å†³å®šæ€§çš„; æœæ–­çš„"}, {en: "desperate", cn: "ç»æœ›çš„; æ‹¼å‘½çš„"}, {en: "devastate", cn: "æ‘§æ¯; ä½¿éœ‡æƒŠ"},
        {en: "engage", cn: "ä»äº‹; äº¤æˆ˜"}, {en: "equip", cn: "è£…å¤‡; é…å¤‡"}, {en: "flee", cn: "é€ƒç¦»"}, {en: "gamble", cn: "èµŒåš; å†’é™©"},
        {en: "harsh", cn: "ä¸¥å‰çš„; åˆºè€³çš„"}, {en: "instruct", cn: "æŒ‡å¯¼; é€šçŸ¥"}, {en: "limp", cn: "è·›è¡Œ"}, {en: "minus", cn: "å‡; è´Ÿçš„"},
        {en: "pursue", cn: "è¿½æ±‚; è¿½è¸ª"}, {en: "render", cn: "è‡´ä½¿; ä½¿å¾—"}, {en: "resistance", cn: "æŠµæŠ—; é˜»åŠ›"},
        {en: "severe", cn: "ä¸¥é‡çš„"}, {en: "severity", cn: "ä¸¥é‡æ€§"}, {en: "shelter", cn: "æ©è”½; åº‡æŠ¤æ‰€"}, {en: "underestimate", cn: "ä½ä¼°"},
        {en: "weaken", cn: "å‰Šå¼±"}, {en: "at the cost of", cn: "ä»¥...ä¸ºä»£ä»·"}, {en: "bide one's time", cn: "ç­‰å¾…æ—¶æœº"},
        {en: "bring ... to a halt", cn: "ä½¿åœæ­¢"}, {en: "catch sb. off guard", cn: "è¶æŸäººä¸å¤‡; è®©äººæªæ‰‹ä¸åŠ"},
        {en: "in part", cn: "éƒ¨åˆ†åœ°"}, {en: "press on/ahead", cn: "æ¨è¿›; åšå®šè¿›è¡Œ"}, {en: "reckon with", cn: "å¤„ç†; é‡è§†"},
        {en: "run out", cn: "ç”¨å®Œ; è€—å°½"}, {en: "slow down", cn: "å‡é€Ÿ; æ”¾æ…¢"}, {en: "take its toll/a heavy toll", cn: "é€ æˆæŸå¤±/ä¸¥é‡æŸå®³"},
        {en: "to one's surprise", cn: "ä»¤æŸäººæƒŠè®¶çš„æ˜¯"}, {en: "turn the tide", cn: "æ‰­è½¬å±€åŠ¿"}, {en: "academic", cn: "å­¦æœ¯çš„; å­¦è€…"},
        {en: "accelerate", cn: "åŠ é€Ÿ"}, {en: "aftermath", cn: "åæœ; ä½™æ³¢"}, {en: "compromise", cn: "å¦¥å; æŸå®³(å®‰å…¨/åèª‰)"},
        {en: "considerably", cn: "ç›¸å½“å¤§ç¨‹åº¦ä¸Š"}, {en: "contribute", cn: "è´¡çŒ®; æœ‰åŠ©äº"}, {en: "convertible", cn: "(è´§å¸)å¯å…‘æ¢çš„"},
        {en: "deploy", cn: "éƒ¨ç½²; æœ‰æ•ˆè¿ç”¨"}, {en: "economic", cn: "ç»æµ(ä¸Š)çš„"}, {en: "fare", cn: "è¿›å±•; é­é‡ (v.)"},
        {en: "flourish", cn: "ç¹è£; å…´æ—º"}, {en: "focus", cn: "ç„¦ç‚¹; é›†ä¸­"}, {en: "grim", cn: "ä¸¥å³»çš„; ç³Ÿç³•çš„"},
        {en: "inflation", cn: "é€šè´§è†¨èƒ€"}, {en: "hub", cn: "ä¸­å¿ƒ; æ¢çº½"}, {en: "initiative", cn: "æ–°æ–¹æ¡ˆ; ä¸»åŠ¨æ€§"},
        {en: "investment", cn: "æŠ•èµ„"}, {en: "issue", cn: "é—®é¢˜; è®®é¢˜"}, {en: "manufacture", cn: "åˆ¶é€ ; ç”Ÿäº§"},
        {en: "mega", cn: "å·¨å¤§çš„"}, {en: "overnight", cn: "ä¸€å¤œä¹‹é—´; çªç„¶"}, {en: "overtake", cn: "è¶…è¿‡; èµ¶ä¸Š"},
        {en: "permanently", cn: "æ°¸ä¹…åœ°"}, {en: "process", cn: "è¿‡ç¨‹"}, {en: "prompt", cn: "å¼•èµ·; æ¿€èµ· (v.)"},
        {en: "remote", cn: "é¥è¿œçš„; ååƒ»çš„"}, {en: "sector", cn: "éƒ¨é—¨; è¡Œä¸š"}, {en: "seemingly", cn: "è¡¨é¢ä¸Š; çœ‹æ¥"},
        {en: "transform", cn: "å½»åº•æ”¹å˜; è½¬åŒ–"}, {en: "trend", cn: "è¶‹åŠ¿"}, {en: "embark on/upon", cn: "ç€æ‰‹; å¼€å§‹åš"},
        {en: "in the midst of", cn: "åœ¨...æœŸé—´; åœ¨...ä¹‹ä¸­"}, {en: "move on", cn: "ç»§ç»­å‰è¿›; è½¬ç§»è¯é¢˜"},
        {en: "on strike", cn: "ç½¢å·¥"}, {en: "open up", cn: "å¼€æ”¾; å¼€å‘"}, {en: "stem from", cn: "æºäº; ç”±...é€ æˆ"}
    ];

    const exerciseGroups = [
        {
            title: "Unit 1: Basic Practice",
            items: [
                { pre: "1. To buy a drink from the machine, first ", blank: "insert", post: " coins." },
                { pre: "2. The economy is just one of the several ", blank: "critical", post: " problems the country is faced with." },
                { pre: "3. The dean is doing his best to ", blank: "promote", post: " a sense of unity." },
                { pre: "4. The world is like a mirror: ", blank: "frown", post: " at it and it frowns at you. (åŸå¥è°šè¯­)" },
                { pre: "5. Video footage appeared to contradict McManus' ", blank: "initial", post: " statement." },
                { pre: "6. Math is needed to explain natural ", blank: "phenomena", post: " (plural)." },
                { pre: "7. They are doing a project to ", blank: "investigate", post: " the harmful effects of air pollution." },
                { pre: "8. As for Laura and me, skin color has never ", blank: "mattered", post: " (past tense)." },
                { pre: "9. Reporters gathered to ", blank: "await", post: " the decision." },
                { pre: "10. ", blank: "On occasion", post: " she is not considered an outstanding student." },
                { pre: "11. The WTO was established to ", blank: "promote", post: " trade." },
                { pre: "12. What you are saying is not ", blank: "relevant", post: " ." },
                { pre: "13. For the experiment to be ", blank: "valid", post: " , record all data accurately." },
                { pre: "14. Hard work can often ", blank: "make up for", post: " a lack of intelligence." },
                { pre: "15. To reduce our ", blank: "reliance", post: " on foreign technology..." }
            ]
        },
        {
            title: "Unit 3/4: Alliance & War Vocab",
            items: [
                { pre: "1. Govern the country in ", blank: "alliance", post: " with the Free Democrats." },
                { pre: "2. Recaptured the city ", blank: "at the cost of", post: " two thousand casualties." },
                { pre: "3. A team of experts were ", blank: "assembled", post: " to study the impact." },
                { pre: "4. The media ", blank: "campaign", post: " was designed to increase public awareness." },
                { pre: "5. Temperatures of minus 65 and ", blank: "plus", post: " 120 degrees." },
                { pre: "6. Firm leadership and ", blank: "decisive", post: " action are needed." },
                { pre: "7. Not altogether ", blank: "to his surprise", post: " , Edna seemed to have feelings..." },
                { pre: "8. Trapped men faced a ", blank: "desperate", post: " struggle to stay alive." },
                { pre: "9. The government forces ", blank: "engaged", post: " the terrorists." },
                { pre: "10. Mary said many ", blank: "harsh", post: " and unkind things." },
                { pre: "11. Exploring the Arctic ", blank: "took a heavy toll", post: " on his health." },
                { pre: "12. First to ", blank: "equip", post: " the classrooms with computers." },
                { pre: "13. Poorly designed as to ", blank: "render", post: " the results meaningless." },
                { pre: "14. Shorten the disease and lessen its ", blank: "severity", post: " ." },
                { pre: "15. Responsibility to ", blank: "instruct", post: " children in good manners." }
            ]
        },
        {
            title: "Phrasal Verbs & Mixed",
            items: [
                { pre: "1. Drugs can ", blank: "slow down", post: " its pace of development." },
                { pre: "2. The president will have to ", blank: "reckon with", post: " angry voices." },
                { pre: "3. Decided to ", blank: "press on", post: " with his plans for reform." },
                { pre: "4. Fears that the world would ", blank: "run out of", post: " fuel." },
                { pre: "5. Just ", blank: "figuring out", post: " how to use the equipment." },
                { pre: "6. Opportunity to ", blank: "size up", post: " his opponent." },
                { pre: "7. A link anchor ", blank: "refers to", post: " the words and pictures." },
                { pre: "8. Problems ", blank: "stem from", post: " their failure to plan." },
                { pre: "9. People ", blank: "opened up", post: " their homes to those affected." },
                { pre: "10. Let's ", blank: "move on", post: " to the last items." },
                { pre: "11. Does not ", blank: "contribute to", post: " our understanding." },
                { pre: "12. Could ", blank: "lead to", post: " an explosion." }
            ]
        },
        {
            title: "Economics & Social Issues",
            items: [
                { pre: "1. The area is so ", blank: "remote", post: " that helicopters had to be used." },
                { pre: "2. He settled ", blank: "permanently", post: " in New York." },
                { pre: "3. A ", blank: "seemingly", post: " peaceful camping trip." },
                { pre: "4. Nothing worthwhile can be accomplished ", blank: "overnight", post: " ." },
                { pre: "5. Re-opened ", blank: "prompted", post: " by repeated air strikes." },
                { pre: "6. Consider, amongst other ", blank: "issues", post: " , the opening-up." },
                { pre: "7. Benefit from their ", blank: "flourishing", post: " business." },
                { pre: "8. Examiners went ", blank: "on strike", post: " ." },
                { pre: "9. Attracts business figures and ", blank: "academics", post: " ." },
                { pre: "10. Currencies were not ", blank: "convertible", post: " ." },
                { pre: "11. Avoid ", blank: "compromising", post: " customers' privacy." },
                { pre: "12. China ", blank: "overtook", post: " Japan in 2010. (Past tense)" },
                { pre: "13. Modest ", blank: "inflation", post: " encourages investment." },
                { pre: "14. Experts giving ", blank: "grim", post: " predictions." },
                { pre: "15. Factories ", blank: "fared", post: " pretty badly in the crisis." }
            ]
        }
    ];

    // === 2. æ ¸å¿ƒé€»è¾‘ä¸å­˜å‚¨ ===
    
    // å­˜å‚¨ Key
    const STORAGE_KEY = 'zhao_english_study_v2';
    
    // è¿è¡Œæ—¶çŠ¶æ€
    let reviewQueue = []; // åŒ…å« {type: 'vocab', index: 0} æˆ– {type: 'exercise', group: 0, item: 0}
    let currentReviewItem = null;

    window.onload = function() {
        loadProgress(); // åŠ è½½å­˜æ¡£
        renderVocabList();
        renderExercises();
        updateStats();
    };

    // --- å­˜å‚¨åŠŸèƒ½ ---
    function saveProgress() {
        // ä¿å­˜å•è¯çŠ¶æ€ã€å¡«ç©ºé¢˜æŒæ¡æƒ…å†µã€å¤ä¹ é˜Ÿåˆ—
        // æˆ‘ä»¬åªä¿å­˜ 'known' çš„å•è¯ç´¢å¼•å’Œ 'wrong' çš„é¢˜ç›®ç´¢å¼•
        const knownVocab = vocabData.map((v, i) => v.status === 'known' ? i : -1).filter(i => i !== -1);
        
        // ä¿å­˜å¤ä¹ é˜Ÿåˆ— (å› ä¸ºåŒ…å«é”™é¢˜)
        const saveData = {
            knownVocab: knownVocab,
            reviewQueue: reviewQueue
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData));
        updateStats();
    }

    function loadProgress() {
        const savedJson = localStorage.getItem(STORAGE_KEY);
        if (savedJson) {
            const data = JSON.parse(savedJson);
            
            // æ¢å¤å•è¯çŠ¶æ€
            if(data.knownVocab) {
                data.knownVocab.forEach(idx => {
                    if(vocabData[idx]) vocabData[idx].status = 'known';
                });
            }
            
            // æ¢å¤å¤ä¹ é˜Ÿåˆ—
            if(data.reviewQueue) {
                reviewQueue = data.reviewQueue;
                // åŒæ­¥å•è¯çš„ review çŠ¶æ€
                reviewQueue.forEach(item => {
                    if(item.type === 'vocab' && vocabData[item.index]) {
                        vocabData[item.index].status = 'review';
                    }
                });
            }
        }
        updateReviewButton();
    }

    function clearAllProgress() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èƒŒè¯å’Œåšé¢˜è®°å½•å—ï¼Ÿæ— æ³•æ’¤é”€å“¦ï¼")) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }

    // --- å•è¯éƒ¨åˆ† ---
    function renderVocabList() {
        const list = document.getElementById('vocab-list');
        const searchTerm = document.getElementById('search').value.toLowerCase();
        list.innerHTML = '';

        vocabData.forEach((item, index) => {
            if (!item.en.toLowerCase().includes(searchTerm)) return;

            const div = document.createElement('div');
            div.className = `vocab-item ${item.status === 'known' ? 'known' : ''} ${item.status === 'review' ? 'unknown' : ''}`;
            div.id = `vocab-${index}`;

            div.innerHTML = `
                <div class="word-row">
                    <span class="english-word">${item.en}</span>
                    ${item.status === 'known' ? 'âœ…' : ''}
                </div>
                
                <div id="mask-${index}" style="margin-top:10px;">
                    <button class="btn-show" onclick="showMeaning(${index})">æŸ¥çœ‹é‡Šä¹‰</button>
                </div>

                <div id="meaning-${index}" class="meaning-box">
                    <div style="font-size:1.1em; margin-bottom:15px; color:#444;">${item.cn}</div>
                    <div class="action-buttons">
                        <button class="btn-wrong" onclick="markWord(${index}, 'review')">ğŸ˜° å¿˜äº†</button>
                        <button class="btn-right" onclick="markWord(${index}, 'known')">ğŸ˜ è®°ä½äº†</button>
                    </div>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function showMeaning(index) {
        document.getElementById(`mask-${index}`).style.display = 'none';
        document.getElementById(`meaning-${index}`).style.display = 'block';
    }

    function markWord(index, status) {
        vocabData[index].status = status;
        document.getElementById(`meaning-${index}`).style.display = 'none';
        document.getElementById(`mask-${index}`).style.display = 'block';
        
        const card = document.getElementById(`vocab-${index}`);
        card.className = `vocab-item ${status === 'known' ? 'known' : 'unknown'}`;
        
        updateReviewQueue('vocab', index, status === 'review');
        saveProgress();
    }

    // --- å¡«ç©ºé¢˜éƒ¨åˆ† (å†™ä¸€ä¸ªåˆ¤ä¸€ä¸ª) ---
    function renderExercises() {
        const container = document.getElementById('exercise-list');
        container.innerHTML = '';
        
        exerciseGroups.forEach((group, gIdx) => {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'exercise-group';
            groupDiv.innerHTML = `<h3>${group.title}</h3>`;
            
            group.items.forEach((item, iIdx) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'exercise-item';
                itemDiv.id = `ex-card-${gIdx}-${iIdx}`;
                
                // æ£€æŸ¥æ˜¯å¦åœ¨å¤ä¹ é˜Ÿåˆ—ä¸­
                const isWrong = reviewQueue.some(q => q.type === 'exercise' && q.group === gIdx && q.item === iIdx);
                if(isWrong) itemDiv.classList.add('wrong-state');

                itemDiv.innerHTML = `
                    <span>${item.pre}</span>
                    <input type="text" 
                           class="blank-input" 
                           data-ans="${item.blank}" 
                           id="input-${gIdx}-${iIdx}"
                           onchange="checkOneExercise(${gIdx}, ${iIdx}, this)"
                           autocomplete="off">
                    <span>${item.post}</span>
                    <div class="ans-tag" id="ans-${gIdx}-${iIdx}">ç­”æ¡ˆ: ${item.blank}</div>
                `;
                groupDiv.appendChild(itemDiv);
            });
            container.appendChild(groupDiv);
        });
    }

    // æ ¸å¿ƒåŠŸèƒ½ï¼šå•é¢˜åˆ¤æ–­
    function checkOneExercise(gIdx, iIdx, input) {
        const userAns = input.value.trim().toLowerCase();
        const correctAns = input.dataset.ans.toLowerCase();
        const card = document.getElementById(`ex-card-${gIdx}-${iIdx}`);
        const ansTag = document.getElementById(`ans-${gIdx}-${iIdx}`);
        
        if (userAns === correctAns) {
            // ç­”å¯¹äº†
            input.className = 'blank-input correct';
            card.classList.remove('wrong-state');
            card.classList.add('correct-state');
            ansTag.style.display = 'none'; // ç­”å¯¹éšè—ç­”æ¡ˆ
            
            // ç§»å‡ºå¤ä¹ é˜Ÿåˆ—
            updateReviewQueue('exercise', {g:gIdx, i:iIdx}, false);
        } else {
            // ç­”é”™äº†
            input.className = 'blank-input wrong';
            card.classList.remove('correct-state');
            card.classList.add('wrong-state');
            ansTag.style.display = 'inline-block'; // ç­”é”™æ˜¾ç¤ºç­”æ¡ˆ
            
            // åŠ å…¥å¤ä¹ é˜Ÿåˆ—
            updateReviewQueue('exercise', {g:gIdx, i:iIdx}, true);
        }
        saveProgress();
    }

    // --- ç»Ÿä¸€å¤ä¹ ç³»ç»Ÿ ---
    function updateReviewQueue(type, data, isAdding) {
        if(type === 'vocab') {
            const index = data;
            if (isAdding) {
                if(!reviewQueue.some(i => i.type === 'vocab' && i.index === index)) {
                    reviewQueue.push({type: 'vocab', index: index});
                }
            } else {
                reviewQueue = reviewQueue.filter(i => !(i.type === 'vocab' && i.index === index));
            }
        } else if (type === 'exercise') {
            const {g, i} = data;
            if (isAdding) {
                if(!reviewQueue.some(q => q.type === 'exercise' && q.group === g && q.item === i)) {
                    reviewQueue.push({type: 'exercise', group: g, item: i});
                }
            } else {
                reviewQueue = reviewQueue.filter(q => !(q.type === 'exercise' && q.group === g && q.item === i));
            }
        }
        updateReviewButton();
    }

    function updateStats() {
        const known = vocabData.filter(i => i.status === 'known').length;
        const total = vocabData.length + 57; // ç®€å•ç²—æš´çš„æ€»æ•°è®¡ç®—
        const progress = Math.round((known / total) * 100);

        document.getElementById('count-known').innerText = known;
        document.getElementById('count-review').innerText = reviewQueue.length;
        document.getElementById('count-total').innerText = total;
        document.getElementById('progress-percent').innerText = progress + '%';
    }

    function updateReviewButton() {
        const btn = document.getElementById('review-btn');
        document.getElementById('review-count-badge').innerText = reviewQueue.length;
        btn.style.display = reviewQueue.length > 0 ? 'block' : 'none';
    }

    function startReviewMode() {
        if (reviewQueue.length === 0) return;
        document.getElementById('review-modal').style.display = 'flex';
        loadNextReviewCard();
    }

    function loadNextReviewCard() {
        if (reviewQueue.length === 0) {
            closeReview();
            alert("ğŸ‰ å¤ªæ£’äº†ï¼é”™é¢˜å…¨éƒ¨å¤ä¹ å®Œæ¯•ï¼");
            return;
        }
        // éšæœºæŠ½é¢˜
        const randIndex = Math.floor(Math.random() * reviewQueue.length);
        currentReviewItem = reviewQueue[randIndex];

        // åˆ‡æ¢ç•Œé¢
        const vocabUI = document.getElementById('vocab-review-ui');
        const exUI = document.getElementById('exercise-review-ui');
        const tag = document.getElementById('card-tag');

        if (currentReviewItem.type === 'vocab') {
            // å•è¯æ¨¡å¼
            vocabUI.style.display = 'block';
            exUI.style.display = 'none';
            tag.innerText = "å•è¯å¤ä¹ ";
            tag.style.background = "#333";
            
            const vData = vocabData[currentReviewItem.index];
            document.getElementById('card-word').innerText = vData.en;
            document.getElementById('card-meaning').innerText = vData.cn;
            document.getElementById('card-mask').style.display = 'block';
            document.getElementById('card-answer').style.display = 'none';
        } else {
            // å¡«ç©ºé¢˜æ¨¡å¼
            vocabUI.style.display = 'none';
            exUI.style.display = 'block';
            tag.innerText = "é”™é¢˜é‡åš";
            tag.style.background = "#e74c3c";

            const exData = exerciseGroups[currentReviewItem.group].items[currentReviewItem.item];
            
            // æ„å»ºé¢˜ç›®æ˜¾ç¤º (æŒ–ç©º)
            document.getElementById('ex-review-content').innerHTML = `
                ${exData.pre} <span style="border-bottom:2px solid #333; padding:0 10px; font-weight:bold;">???</span> ${exData.post}
            `;
            const input = document.getElementById('ex-review-input');
            input.value = '';
            input.dataset.ans = exData.blank;
            input.focus();
            document.getElementById('ex-feedback').innerText = '';
            document.getElementById('ex-feedback').style.color = '#333';
        }
    }

    function revealCard() {
        document.getElementById('card-mask').style.display = 'none';
        document.getElementById('card-answer').style.display = 'block';
    }

    function processVocabReview(isCorrect) {
        if (isCorrect) {
            markWord(currentReviewItem.index, 'known');
        }
        loadNextReviewCard();
    }

    function checkReviewExercise() {
        const input = document.getElementById('ex-review-input');
        const feedback = document.getElementById('ex-feedback');
        const userAns = input.value.trim().toLowerCase();
        const correctAns = input.dataset.ans.toLowerCase();

        if (userAns === correctAns) {
            feedback.innerText = "âœ… æ­£ç¡®ï¼å·²ç§»å‡ºå¤ä¹ é˜Ÿåˆ—ã€‚";
            feedback.style.color = "var(--success)";
            // ç§»é™¤é˜Ÿåˆ—
            updateReviewQueue('exercise', {g:currentReviewItem.group, i:currentReviewItem.item}, false);
            saveProgress();
            
            // ç•Œé¢åŒæ­¥æ›´æ–° (æŠŠåˆ—è¡¨é‡Œçš„çº¢æ¡†å»æ‰)
            const listCard = document.getElementById(`ex-card-${currentReviewItem.group}-${currentReviewItem.item}`);
            if(listCard) {
                listCard.classList.remove('wrong-state');
                listCard.classList.add('correct-state');
                const listInput = document.getElementById(`input-${currentReviewItem.group}-${currentReviewItem.item}`);
                if(listInput) {
                    listInput.className = 'blank-input correct';
                    listInput.value = input.dataset.ans; // è‡ªåŠ¨å¸®ä»–åœ¨åˆ—è¡¨é‡Œå¡«ä¸Šå¯¹çš„
                }
            }
            
            setTimeout(loadNextReviewCard, 1000);
        } else {
            feedback.innerText = "âŒ é”™è¯¯ï¼Œå†è¯•ä¸€æ¬¡ï¼(æ³¨æ„æ—¶æ€/å¤æ•°)";
            feedback.style.color = "var(--error)";
            input.classList.add('wrong');
            setTimeout(() => input.classList.remove('wrong'), 500); // Shake visual hook could go here
        }
    }

    function closeReview() {
        document.getElementById('review-modal').style.display = 'none';
        renderVocabList(); // åˆ·æ–°åˆ—è¡¨çŠ¶æ€
    }

    function switchTab(tabId) {
        document.getElementById('vocab-section').style.display = tabId === 'vocab' ? 'block' : 'none';
        document.getElementById('exercise-section').style.display = tabId === 'exercise' ? 'block' : 'none';
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
    }
</script>

</body>
</html>